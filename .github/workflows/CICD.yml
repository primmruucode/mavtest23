# This is a basic workflow to help you get started with Actions
name: CI
run-name: Deploy to ${{ inputs.deploy_target }} by @${{ github.actor }}
on:
  push:
    branches: Dev

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
      # Runs a single command using the runners shell
      name: CI test build maven 
      uses: ./.github/workflows/buildreuse.yml
      with: 
          path_to_settings: .maven/settings.xml
          path_to_pom: pom.xml
      secrets:
        ANYPOINT_PLATFORM_USERNAME: ${{ secrets.ANYPOINT_PLATFORM_USERNAME }}        
        ANYPOINT_PLATFORM_PASSWORD : ${{ secrets.ANYPOINT_PLATFORM_PASSWORD }}
        
  deployqa:
      needs: build
      name: CD for staging
      uses: ./.github/workflows/deployreuse.yml
      with:
        CLOUDHUB_ENVIRONMENT: "qa-01"    
        CLOUDHUB_WORKERS: "1"
        CLOUDHUB_WORKER_TYPE: "MICRO"
        CLOUDHUB_REGION: "ca-central-1"
        APP_NAME: "QA-01"
      secrets:
        ANYPOINT_PLATFORM_USERNAME: ${{ secrets.ANYPOINT_PLATFORM_USERNAME }}        
        ANYPOINT_PLATFORM_PASSWORD : ${{ secrets.ANYPOINT_PLATFORM_PASSWORD }}
        
  deploydev:
      needs: build
      if: github.event.inputs.choice == 'Prod' 
      name: CD for production
      uses: ./.github/workflows/deployreuse.yml
      with:
        CLOUDHUB_ENVIRONMENT: "dev-01"    
        CLOUDHUB_WORKERS: "1"
        CLOUDHUB_WORKER_TYPE: "MICRO"
        CLOUDHUB_REGION: "ca-central-1"
        APP_NAME: "DEV-01"
      secrets:
        ANYPOINT_PLATFORM_USERNAME: ${{ secrets.ANYPOINT_PLATFORM_USERNAME }}        
        ANYPOINT_PLATFORM_PASSWORD : ${{ secrets.ANYPOINT_PLATFORM_PASSWORD }}
      
      
